<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Scaventure - the Adventure Awaits</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="assets/scaventure.min.css" />
    <link rel="stylesheet" href="assets/jquery.mobile.icons.min.css" />
    <link rel="stylesheet" href="assets/jquery.mobile.structure-1.4.2.min.css" />
    <script src="assets/jquery-1.11.1.min.js"></script>
    <script src="assets/jquery.mobile-1.4.2.min.js"></script>

    <!--Google Fonts-->
    <link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Seaweed+Script">
    <link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Abel">

    <script>
    // function to read storage and init form
    function checkStorage() {
        // check if local storage available
        if (window.localStorage) {
            var key, value, field;
            // loop through local storage
            for (var i = 0; i < localStorage.length; i++) {
                // retrieve the key
                key = localStorage.key(i);
                
                // set the field from the key
                field = document.getElementById(key);
                
                // check for field and assign value
                if (field) {
                    // retrieve the value
                    value = unescape(localStorage.getItem(key));
                    // set the field value
                    field.value = value; 
                }
            } // end for loop
        } // end local storage check 
    } // end function
    
    // set the localStorage with the changed field
    function updateStorage(elKey, elValue) {
        // check if local storage is available
        if (window.localStorage) {
            var key, value;
            
            // set key to form field id
            key = elKey;
            
            // set value to form field value
            value = elValue;
            
            // try to set item in local storage 
            try {
                localStorage.setItem(key, value);
                var savedVal = localStorage.getItem(key);
                console.log("Saved [" + key + "] into localStorage with the Value => " + savedVal);
            }
            catch (err) {
                //unable to set item in local storage
                if (err.code == QUOTA_EXCEEDED_ERR) {
                    alert('localStorage ran out of memory.'); }
                }
            } else {
                alert('localStorage is not supported.');
            } 
        }
    // initialize our form from local storage
    window.addEventListener('load',checkStorage,false);
    </script>
    
    <script>
    $(document).ready(function(){
        
        //<!--CRAIG COPY FROM HERE BELOW -->

        //get json from local storage
        var json = JSON.parse(localStorage.getItem('json'));
        //get city/hunt from local storage
        var city = localStorage.getItem('city');
        var cityID = localStorage.getItem('cityID');
        var hunt = localStorage.getItem('hunt');
        var huntID = localStorage.getItem('huntID');

        //get player's current clue ID
        var onClueID = localStorage.getItem('onClueID');

        //if local storage does not have 'onClueID', set it to 0
        if (onClueID == null){
            onClueID = 0;
        }

        //ensure local storage is not missing city, cityID, hunt, and huntID
        if (city !== null && cityID != null && hunt !== null && huntID != null){
            console.log("Starting Scaventure with City => " + city + " (ID: => " + cityID + ") and Hunt => " + hunt + " (ID: => " + huntID + ")");
            console.log("Player is on Clue ID => " + onClueID);

            //populate Header with City > Hunt
            $("#header").html(city + " > " + hunt);
            //populate hunt description DIV
            $("#huntDesc").text("Description: " + json.scaventure.cities[cityID].hunt[huntID].desc);

            //populate clues output based on city and hunt and player's 'onClueID'
            var output = "";

            $.each(json.scaventure.cities[cityID].hunt[huntID].clues, function(key, value) {
                //gather clue index and clue
                var clueIndex = key + 1;
                var clue = value.desc;    

                //print solved clue name with a star
                if ((clueIndex-1) < onClueID){
                    output += "<a href='#' class='ui-btn ui-icon-star ui-btn-icon-left'>Clue " + clueIndex + "</a>";      
                }
                //print current clue with clue name
                if ((clueIndex-1) == onClueID){
                    output += "<div data-role='collapsible'>";
                    output += "<h1>Clue " + clueIndex + "</h1><p>" + clue + "</p></div>";      
                }
                
            }); 

            //populate clues
            $("#clues").html(output);
        }
        
    });
    </script>
</head>
<body>
    <div data-role="page">
    <!-- header -->
    <div data-role="header"> 
        <h1 id="header"></h1> 
    </div>

    <!-- content -->
    <div data-role="content" data-inset="true">
         <div data-role="main" class="ui-content">
            <div id="huntDesc"></div>
            <div id="clues"></div>
        </div>
        <a href="theHunt.html" data-role="button">Am I Here?</a>
    </div><!-- /content -->

    </div><!-- /page -->
</body>
</html>