<!DOCTYPE html>
<html>
<head>
	<title>Scaventure - the Adventure Awaits</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="assets/scaventure.min.css" />
    <link rel="stylesheet" href="assets/jquery.mobile.icons.min.css" />
    <link rel="stylesheet" href="assets/jquery.mobile.structure-1.4.2.min.css" />
    <link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Seaweed+Script">
    <link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Abel">

    <script src="assets/jquery-1.11.1.min.js"></script>
    <script src="assets/jquery.mobile-1.4.2.min.js"></script>

    <script>
    // function to read storage and init form
    function checkStorage() {
        // check if local storage available
        if (window.localStorage) {
            var key, value, field;
            // loop through local storage
            for (var i = 0; i < localStorage.length; i++) {
                // retrieve the key
                key = localStorage.key(i);
                
                // set the field from the key
                field = document.getElementById(key);
                
                // check for field and assign value
                if (field) {
                    // retrieve the value
                    value = unescape(localStorage.getItem(key));
                    // set the field value
                    field.value = value; 
                }
            } // end for loop
        } // end local storage check 
    } // end function
    
    // set the localStorage with the changed field
    function changeField(elKey, elValue) {
        // check if local storage available
        if (window.localStorage) {
            var key, value;
            
            // set key to form field id
            key = elKey;
            
            // set value to form field value
            value = elValue;
            
            // try to set item in local storage 
            try {
                localStorage.setItem(key, value); 
            }
            catch (err) {
                if (err.code == QUOTA_EXCEEDED_ERR) {
                    alert('localStorage ran out of memory.'); }
                }
            } else {
                alert('localStorage is not supported.');
            } 
        }
    // initialize our form from storage
    window.addEventListener('load',checkStorage,false);
    </script>
    
	<script>
 	$(document).ready(function(){
 		var json;
    	//load the json object into the local storage

	    $.getJSON("assets/scaventureJSON.json", function(result) {
			json = result;

            $.each(json.scaventure.cities, function(key, value) {
                $("#cityList").append($("<option></option>").attr("value",value.name).text(value.name));
                $("#cityList").trigger("change");
            });
	    });

        $("#cityList").bind("change", function(){
            var city = $("#cityList").val();
            changeField('city', city);

            $("#huntList").empty();
            
            // console.log(json.scaventure.cities.name);

            $.each(json.scaventure.cities, function(key, value) {
                if (value.name == city){
                   $.each(json.scaventure.cities[key].hunt, function(key, value) {
                        $("#huntList").append($("<option></option>").attr("value",value.name).text(value.name));
                        $("#huntList").trigger("change");
                    });          
                } 
            });
            $("#huntList").trigger("change");
        });

        $("#huntList").bind("change", function(){
            var hunt = $("#huntList").val();
            changeField('hunt', hunt);
        });
	});
	</script>
</head>
<body>
	<div data-role="page">
    <!-- header -->
    <div data-role="header">
        <a href="index.html" data-icon="home">Home</a>
        <h1>Scaventure</h1>
    </div>
    <br/>
    <!-- logo-->
    <div data-role="main" class="ui-content">
        <img src="assets/images/mustache.png" width="70" height="70" style="float: right; display: block;"></img>
    </div>

    <!-- content -->
    <div data-role="content" data-inset="true">
    	<div data-role="fieldcontain">
			<label for="select-choice-custom" class="select">Select a City:</label>
			<select name="select-choice-1" id="cityList" data-native-menu="false"></select>
		</div>
    </div>
    <div data-role="content" data-inset="true">
        <div data-role="fieldcontain">
            <label for="select-choice-custom" class="select">Select a Hunt:</label>
            <select name="select-choice-1" id="huntList" data-native-menu="false"></select>
        </div>
    </div>
    <a href="theHunt.html" data-role="button">Start Game</a> 
    <!-- /content -->

    <div data-role="footer">
        <h4>2014 Scaventure - MIST 7571 | Team Awesome</h4>
    </div><!-- /footer -->

</div><!-- /page -->
</body>
</html>